(function(){AJS.$(function(){var c=AJS.$("#cf-config-icon-options");if(c.length==0){return}var d=WRM.data.claim("com.codebarrel.iconselect:fieldConfig");var f=WRM.data.claim("com.codebarrel.iconselect:customField");var i=WRM.data.claim("com.codebarrel.iconselect:defaultAvatar");var a=AJS.contextPath()+"/rest/iconselectoptions/1.0/option/context/"+d;var h=AJS.RestfulTable.Row.extend({initialize:function(){var j=this;AJS.RestfulTable.Row.prototype.initialize.apply(this,arguments);this.bind(this._event.RENDER,function(l,m){var k=$(this.el);k.find(".aui-restfultable-operations").append(com.codebarrel.iconselect.config.restfulltable.operations());if(m.disabled){k.addClass("iconselect-options-config-disabled");k.addClass("disabled")}else{k.addClass("iconselect-options-config-enabled")}k.find(".icon-select-disable").click(function(n){JIRA.SmartAjax.makeRequest({url:a+"/"+m.id+"/disable",type:"POST",dataType:"json",complete:function(r,p,o){var s=o.data;if(typeof o.data==="string"){s=JSON.parse(o.data)}var q=!(r.status===400&&s&&s.errors);if(o.successful){k.addClass("iconselect-options-config-disabled");k.addClass("disabled");k.removeClass("iconselect-options-config-enabled")}else{if(q){alert("Error while disabling option. Reload and try again. If it pesists contact your administrator")}}}})});k.find(".icon-select-enable").click(function(n){JIRA.SmartAjax.makeRequest({url:a+"/"+m.id+"/enable",type:"POST",dataType:"json",complete:function(r,p,o){var s=o.data;if(typeof o.data==="string"){s=JSON.parse(o.data)}var q=!(r.status===400&&s&&s.errors);if(o.successful){k.addClass("iconselect-options-config-enabled");k.removeClass("iconselect-options-config-disabled");k.removeClass("disabled")}else{if(q){alert("Error while enabling option. Reload and try again. If it pesists contact your administrator")}}}})})})}});var e=AJS.RestfulTable.CustomEditView.extend({render:function(j){var k=j.value==null?i:j.value;var l=AJS.$(com.codebarrel.iconselect.config.restfulltable.iconEditView({name:j.name,value:k,contextPath:AJS.contextPath()}));JIRA.createUniversalAvatarPickerDialog({trigger:l,title:AJS.I18n.getText("icon.option.select.icon.title"),projectId:f,defaultAvatarId:i,initialSelection:k,avatarSize:JIRA.Avatar.getSizeObjectFromName("xsmall"),avatarType:"iconselectlist",select:function(m,n){l.find("img").attr("src",n);l.find("input").val(m.getId())}});return l}});var g=AJS.RestfulTable.CustomReadView.extend({render:function(j){return com.codebarrel.iconselect.config.restfulltable.iconReadView({value:j.value,contextPath:AJS.contextPath()})}});var b=new AJS.RestfulTable({autoFocus:true,el:c,allowReorder:true,addPosition:"bottom",noEntriesMsg:AJS.I18n.getText("icon.option.configure.no.options"),resources:{all:a,self:a},columns:[{id:"avatarId",name:"avatarId",header:AJS.I18n.getText("icon.option.icon"),styleClass:"iconselect-options-config-avatar",readView:g,editView:e},{id:"label",name:"label",styleClass:"iconselect-options-config-label",header:AJS.I18n.getText("icon.option.label")}],views:{row:h}})})})();